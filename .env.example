# WebAppChat Environment Configuration
# Copy this file to .env and fill in your values
#
# Required variables are marked with [REQUIRED]
# Optional variables have sensible defaults

# =============================================================================
# API Keys [REQUIRED - at least one LLM provider]
# =============================================================================

# OpenAI API Key (required for GPT models and embeddings)
# Get yours at: https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-proj-your-openai-key-here

# Anthropic API Key (required for Claude models)
# Get yours at: https://console.anthropic.com/settings/keys
ANTHROPIC_API_KEY=sk-ant-api03-your-anthropic-key-here

# Google API Key (optional, for Gemini models - experimental)
GOOGLE_API_KEY=your-google-api-key-here

# =============================================================================
# LLM Settings
# =============================================================================

# Default model to use (options: gpt-4o-mini, claude-3-5-haiku-20241022, etc.)
DEFAULT_MODEL=gpt-4o-mini

# Maximum context tokens for conversation history
MAX_CONTEXT_TOKENS=8000

# Agent mode: 'agentic' (structured tools) or 'autonomous' (simplified tools)
AGENT_MODE=agentic

# =============================================================================
# Obsidian Vault [REQUIRED]
# =============================================================================

# Path to your Obsidian vault
# Docker: /app/vault (mounted from host)
# Local: /home/yourname/Documents/ObsidianVault
VAULT_PATH=/app/vault

# Name of your vault (for Obsidian deep links)
VAULT_NAME=MyVault

# Vault folder structure (customize for your organization)
INBOX_FOLDER=00-Inbox
DAILY_NOTES_FOLDER=60-Calendar/Daily
TEMPLATES_FOLDER=90-Meta/Templates
ATTACHMENTS_FOLDER=90-Meta/Attachments

# Folders to exclude from RAG indexing (JSON array format)
RAG_EXCLUDE_FOLDERS=["00-Inbox","90-Meta"]

# Microsoft To Do sync file path (relative to vault root)
TODO_SYNC_PATH=60-Calendar/Task-List.md

# User timezone for date calculations and LLM context
TIMEZONE=US/Eastern

# =============================================================================
# RAG (Retrieval-Augmented Generation) Settings
# =============================================================================

# Size of text chunks for RAG (in tokens)
CHUNK_SIZE=500

# Embedding model to use
EMBEDDING_MODEL=text-embedding-3-small

# Number of top results to retrieve from RAG
TOP_K=5

# Enable automatic RAG synchronization of vault files
RAG_AUTO_SYNC_ENABLED=true

# Interval in minutes between automatic RAG syncs (5-60)
RAG_AUTO_SYNC_INTERVAL_MINUTES=15

# Perform RAG sync on application startup
RAG_SYNC_ON_STARTUP=true

# Path to RAG sync log file
RAG_SYNC_LOG_PATH=logs/rag_sync.log

# =============================================================================
# Ollama (Local Models) - Optional
# =============================================================================

# Ollama service URL
# Local: http://localhost:11434
# Docker: http://host.docker.internal:11434
OLLAMA_HOST=http://localhost:11434

# Prompt variant for local models (NO_PROMPT, LLAMA, QWEN, etc.)
OLLAMA_PROMPT_VARIANT=NO_PROMPT

# Temperature for local model inference (0.0-2.0)
OLLAMA_TEMPERATURE=0.1

# Directory to write Ollama payload debug JSON (empty to disable)
OLLAMA_PAYLOAD_DEBUG_DIR=

# =============================================================================
# MCP (Model Context Protocol) - For Local Models
# =============================================================================

# Enable/disable MCP filesystem access for local models
MCP_ENABLED=true

# Allowed directories for MCP filesystem access (comma-separated)
MCP_ALLOWED_DIRS=/app/vault

# Maximum function call iterations (prevents infinite loops)
MCP_MAX_ITERATIONS=5

# Timeout for function execution (seconds)
MCP_FUNCTION_TIMEOUT=30

# Log function calls for debugging
MCP_LOG_FUNCTION_CALLS=true

# =============================================================================
# Flask Configuration
# =============================================================================

# Environment (development or production)
FLASK_ENV=production

# Enable debug mode (true/false)
FLASK_DEBUG=false

# Port to run on
PORT=5000

# Flask session secret key (should be a random 32+ character string)
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
FLASK_SECRET_KEY=generate-a-random-secret-key-here

# =============================================================================
# Authentication
# =============================================================================

# Enable/disable authentication on protected routes
AUTH_ENABLED=true

# Session cookie lifetime in days (1-365)
SESSION_LIFETIME_DAYS=30

# Number of bcrypt rounds for password hashing (10-14)
BCRYPT_ROUNDS=12

# Rate limit for login attempts (e.g., "5/minute", "10/hour")
LOGIN_RATE_LIMIT=5/minute

# =============================================================================
# Rate Limiting
# =============================================================================

# Enable rate limiting (true/false)
RATE_LIMIT_ENABLED=true

# Default rate limit for all endpoints
RATE_LIMIT_DEFAULT=1000 per day, 500 per hour

# Rate limit for expensive /ask and /ask-stream endpoints
RATE_LIMIT_ASK=50 per minute

# =============================================================================
# Storage
# =============================================================================

# Use SQLite for chats instead of JSON files (true/false)
USE_SQLITE_CHATS=true

# Directory for chat JSON files (if not using SQLite)
CHATS_DIR=chats

# SQLite database path for chats
CHAT_DB_PATH=chats.sqlite3

# SQLite database path for RAG
RAG_DB_PATH=rag.sqlite3

# Usage log CSV file path
USAGE_LOG_PATH=chats/usage_log.csv

# =============================================================================
# WebDAV Configuration (Obsidian Vault Sync)
# =============================================================================

# Enable WebDAV server
WEBDAV_ENABLED=true
WEBDAV_PORT=8080
WEBDAV_LOG_LEVEL=INFO
WEBDAV_MAX_FILE_SIZE=104857600

# WebDAV Authentication (JSON format with bcrypt hashes)
# Generate credentials: python scripts/generate_webdav_credentials.py <device_name>
WEBDAV_AUTH_USERS={}

# Paths to deny access (regex patterns)
WEBDAV_DENIED_PATHS=^\.git/|^\.git$|~$|\.tmp$|\.swp$|\.DS_Store$

# Debug mode (logs all requests)
WEBDAV_DEBUG=false

# Vault path inside WebDAV container
WEBDAV_VAULT_PATH=/app/vault

# =============================================================================
# Microsoft 365 Integration (Optional)
# =============================================================================
# For Microsoft To Do sync. Set up at: https://portal.azure.com/ → App registrations

# OAuth Application Credentials
WEBCHAT_CLIENT_ID=
WEBCHAT_CLIENT_SECRET=
WEBCHAT_TENANT_ID=common
WEBCHAT_REDIRECT_URI=http://localhost:5000/auth/callback

# =============================================================================
# Home Assistant Integration (Optional)
# =============================================================================

# Home Assistant instance URL
HOME_ASSISTANT_URL=http://192.168.x.x:8123

# Long-lived access token (generate in HA: Profile → Long-lived access tokens)
HOME_ASSISTANT_TOKEN=

# Request timeout in seconds
HOME_ASSISTANT_TIMEOUT=10

# =============================================================================
# N8N Webhook Integration (Optional)
# =============================================================================

# N8N webhook URL for light control automation
N8N_LIGHT_CONTROL_URL=

# Webhook request timeout in seconds
N8N_WEBHOOK_TIMEOUT=10

# =============================================================================
# Debug & Development
# =============================================================================

# Allow debug endpoint at /_debug_env (true/false)
ALLOW_DEBUG_ENDPOINT=false
